/*!
 * NEWSOUL's production http://inwedding.cn
 * Copyright 2016
 * Author zmf http://blog.newsoul.cn
 * This is NOT a freeware, use is subject to license terms
 */
function rebind(){$("a[action=get-contents]").unbind("click").click(function(){var a=$(this);getContents(a)}),$("a[action=favorite]").unbind("tap").tap(function(){var a=$(this);favorite(a)}),$("a[action=vote]").unbind("tap").tap(function(){cancelBindLink();var a=$(this);addVote(a)}),$("a[action=add-comment]").click(function(){var a=$(this);addComment(a)}),$(".comment-textarea").unbind("click").click(function(){$(".toggle-area").each(function(){$(this).fadeIn(500)})}),$("img.lazy").lazyload({threshold:600}),bindLink()}function bindLink(){$(".ui-grid-full li,.ui-list li,.ui-row li,.ui-avatar,.ui-col").unbind("click").click(function(){$(this).attr("data-href")&&(location.href=$(this).attr("data-href"))})}function cancelBindLink(){$(".ui-grid-full li,.ui-list li,.ui-row li,.ui-avatar,.ui-col").unbind("tap")}function dialog(a){if("object"!=typeof a)return!1;if(a.title||(a.title=""),"1"===zmf.fromApp)return loadApp("dialog",{diaTitle:a.title,diaContent:a.msg}),!1;var b=[];b=a.buttons?a.buttons:["关闭"];var c=$.dialog({title:a.title,content:a.msg,button:b});c.on("dialog:action",function(a){"下载"===b[a.index]&&(window.location.href="http://www.inwedding.cn/")}),c.on("dialog:hide",function(a){})}function checkAjax(){return ajaxReturn?(ajaxReturn=!1,!0):(dialog({msg:"请求正在发送中，请稍后"}),!1)}function addComment(dom){var k=dom.attr("action-data"),t=dom.attr("action-type"),to=parseInt($("#replyoneHolder-"+k).attr("tocommentid")),c=$("#content-"+t+"-"+k).val(),username=$("#username-"+t+"-"+k).val(),email=$("#email-"+t+"-"+k).val();if(!k||!t||!c)return dialog({msg:"请填写内容"}),!1;if(username||(username=""),email||(email=""),!checkLogin()){if(!username)return dialog({msg:"请填写称呼"}),!1;if(""!=email){var reg=/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/;if(!reg.test(email))return dialog({msg:"请填写正确的邮箱地址"}),!1}}return to||(to=0),checkAjax()?void $.post(zmf.addCommentUrl,{k:k,t:t,c:c,to:to,email:email,username:username,YII_CSRF_TOKEN:zmf.csrfToken},function(result){ajaxReturn=!0,result=eval("("+result+")"),"1"==result.status?($("#content-"+t+"-"+k).val(""),$("#comments-"+t+"-"+k).append(result.msg),cancelReplyOne(k)):dialog({msg:result.msg})}):!1}function favorite(a){if(!checkLogin())return dialog({msg:"请先登录"}),!1;var b=a.attr("action-data"),c=a.attr("action-type"),d=a.html();return b&&c&&checkAjax()?void $.post(zmf.favoriteUrl,{type:c,data:b,YII_CSRF_TOKEN:zmf.csrfToken},function(b){return ajaxReturn=!0,b=$.parseJSON(b),1===b.status?a.html('<i class="ui-icon-liked"></i>'):2===b.status?a.text(d):3===b.status?a.html('<i class="ui-icon-like"></i>'):4===b.status?a.text(d):dialog({msg:b.msg}),!1}):!1}function replyOne(a,b,c){var d="<span class='reply-one'>回复“"+c+"”<a href='javascript:' onclick='cancelReplyOne("+b+")' title='取消设置'> <i class='ui-icon-close-page'></i></a></span>",e=$("#replyoneHolder-"+b).offset().top;$("html,body").animate({scrollTop:e},1e3),$("#replyoneHolder-"+b).attr("tocommentid",a).html(d)}function cancelReplyOne(a){$("#replyoneHolder-"+a).attr("tocommentid","").html("")}function checkLogin(){return"undefined"==typeof zmf.hasLogin?!1:"true"===zmf.hasLogin?!0:!1}var ajaxReturn=!0;!function(a,b,c,d){var e=a(b);a.fn.lazyload=function(c){function f(){var b=0;h.each(function(){var c=a(this);if(!i.skip_invisible||"none"!==c.css("display"))if(a.abovethetop(this,i)||a.leftofbegin(this,i));else if(a.belowthefold(this,i)||a.rightoffold(this,i)){if(++b>i.failure_limit)return!1}else c.trigger("appear"),b=0})}var g,h=this,i={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:b,data_attribute:"original",skip_invisible:!0,appear:null,load:null};return c&&(d!==c.failurelimit&&(c.failure_limit=c.failurelimit,delete c.failurelimit),d!==c.effectspeed&&(c.effect_speed=c.effectspeed,delete c.effectspeed),a.extend(i,c)),g=i.container===d||i.container===b?e:a(i.container),0===i.event.indexOf("scroll")&&g.on(i.event,function(){return f()}),this.each(function(){var b=this,c=a(b);b.loaded=!1,c.one("appear",function(){if(!this.loaded){if(i.appear){var d=h.length;i.appear.call(b,d,i)}a("<img />").on("load",function(){var d,e;c.hide().attr("src",c.data(i.data_attribute))[i.effect](i.effect_speed),b.loaded=!0,d=a.grep(h,function(a){return!a.loaded}),h=a(d),i.load&&(e=h.length,i.load.call(b,e,i))}).attr("src",c.data(i.data_attribute))}}),0!==i.event.indexOf("scroll")&&c.on(i.event,function(){b.loaded||c.trigger("appear")})}),e.on("resize",function(){f()}),/iphone|ipod|ipad.*os 5/gi.test(navigator.appVersion)&&e.on("pageshow",function(b){b=b.originalEvent||b,b.persisted&&h.each(function(){a(this).trigger("appear")})}),a(b).on("load",function(){f()}),this},a.belowthefold=function(c,f){var g;return g=f.container===d||f.container===b?e.height()+e.scrollTop():a(f.container).offset().top+a(f.container).height(),g<=a(c).offset().top-f.threshold},a.rightoffold=function(c,f){var g;return g=f.container===d||f.container===b?e.width()+e[0].scrollX:a(f.container).offset().left+a(f.container).width(),g<=a(c).offset().left-f.threshold},a.abovethetop=function(c,f){var g;return g=f.container===d||f.container===b?e.scrollTop():a(f.container).offset().top,g>=a(c).offset().top+f.threshold+a(c).height()},a.leftofbegin=function(c,f){var g;return g=f.container===d||f.container===b?e[0].scrollX:a(f.container).offset().left,g>=a(c).offset().left+f.threshold+a(c).width()},a.inviewport=function(b,c){return!(a.rightoffold(b,c)||a.leftofbegin(b,c)||a.belowthefold(b,c)||a.abovethetop(b,c))},a.extend(a.fn,{"below-the-fold":function(b){return a.belowthefold(b,{threshold:0})},"above-the-top":function(b){return!a.belowthefold(b,{threshold:0})},"right-of-screen":function(b){return a.rightoffold(b,{threshold:0})},"left-of-screen":function(b){return!a.rightoffold(b,{threshold:0})},"in-viewport":function(b){return a.inviewport(b,{threshold:0})},"above-the-fold":function(b){return!a.belowthefold(b,{threshold:0})},"right-of-fold":function(b){return a.rightoffold(b,{threshold:0})},"left-of-fold":function(b){return!a.rightoffold(b,{threshold:0})}})}($,window,document),rebind();